"use strict";
/** @type { (ExtendedItemOption & { ExpressionTrigger: ExpressionTrigger[] } )[]} */
const InventoryItemHandsSpankingToysOptions = [
	{
		Name: "Crop",
		Property: { Type: null },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }]
	}, {
		Name: "Flogger",
		Property: { Type: "Flogger" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }]
	}, {
		Name: "Cane",
		Property: { Type: "Cane" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Wink", Timer: 5 }]
	}, {
		Name: "HeartCrop",
		Property: { Type: "HeartCrop" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }]
	}, {
		Name: "Paddle",
		Property: { Type: "Paddle" },
		ExpressionTrigger: [{ Group: "Blush", Name: "High", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Closed", Timer: 5 }]
	}, {
		Name: "WhipPaddle",
		Property: { Type: "WhipPaddle" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Wink", Timer: 5 }]
	}, {
		Name: "Whip",
		Property: { Type: "Whip" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Wink", Timer: 5 }]
	}, {
		Name: "CattleProd",
		Property: { Type: "CattleProd" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Wink", Timer: 5 }]
	}, {
		Name: "TennisRacket",
		Property: { Type: "TennisRacket" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }]
	}, {
		Name: "RainbowWand",
		Property: { Type: "RainbowWand" },
		ExpressionTrigger: [{ Group: "Eyebrows", Name: "Soft", Timer: 5 }]
	}, {
		Name: "Gavel",
		Property: { Type: "Gavel" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyes", Name: "Closed", Timer: 5 }]
	}, {
		Name: "Feather",
		Property: { Type: "Feather" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, {Group: "Eyes", Name: "Closed", Timer: 10}, { Group: "Mouth", Name: "Grin", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "FeatherDuster",
		Property: { Type: "FeatherDuster" },
		ExpressionTrigger: [{ Group: "Blush", Name: "High", Timer: 10 }, { Group: "Eyes", Name: "Closed", Timer: 10}, { Group: "Mouth", Name: "Laughing", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "LongDuster",
		Property: { Type: "LongDuster" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyes", Name: "Closed", Timer: 10}, { Group: "Mouth", Name: "Laughing", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "IceCube",
		Property: { Type: "IceCube" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10}, { Group: "Mouth", Name: "Angry", Timer: 10}, { Group: "Eyes", Name: "Daydream", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "WartenbergWheel",
		Property: { Type: "WartenbergWheel" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10}, { Group: "Eyes", Name: "Daydream", Timer: 10}]
	}, {
		Name: "VibratingWand",
		Property: { Type: "VibratingWand" },
		ExpressionTrigger: [{ Group: "Blush", Name: "High", Timer: 10 }, { Group: "Eyes", Name: "VeryLewd", Timer: 5 }, { Group: "Eyebrows", Name: "Soft", Timer: 10}, { Group: "Mouth", Name: "Open", Timer: 10}]
	}, {
		Name: "SmallVibratingWand",
		Property: { Type: "SmallVibratingWand" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyes", Name: "Dazed", Timer: 5 }, { Group: "Eyebrows", Name: "Soft", Timer: 10}, { Group: "Mouth", Name: "HalfOpen", Timer: 10}]
	}, {
		Name: "CandleWax",
		Property: { Type: "CandleWax" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Surprised", Timer: 10}, { Group: "Mouth", Name: "Frown", Timer: 10}]
	}, {
		Name: "LargeDildo",
		Property: { Type: "LargeDildo" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "HalfOpen", Timer: 10}, { Group: "Eyes", Name: "Lewd", Timer: 10}]
	}, {
		Name: "PetToy",
		Property: { Type: "PetToy" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyes", Name: "WinkL", Timer: 10 }, { Group: "Mouth", Name: "Smirk", Timer: 10 }]
	},{
		Name: "Vibrator",
		Property: { Type: "Vibrator" },
		ExpressionTrigger: [{ Group: "Blush", Name: "High", Timer: 10 }, { Group: "Eyes", Name: "VeryLewd", Timer: 10 }, { Group: "Mouth", Name: "Open", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	},{
		Name: "Belt",
		Property: { Type: "Belt" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10}]
	}, {
		Name: "Hairbrush",
		Property: { Type: "Hairbrush" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10}]
	}, {
		Name: "SmallDildo",
		Property: { Type: "SmallDildo" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10}, { Group: "Eyes", Name: "Lewd", Timer: 5 }, ]
	}, {
		Name: "ElectricToothbrush",
		Property: { Type: "ElectricToothbrush" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, {Group: "Eyes", Name: "Closed", Timer: 10}, { Group: "Mouth", Name: "Grin", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "Toothbrush",
		Property: { Type: "Toothbrush" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, {Group: "Eyes", Name: "Closed", Timer: 10}, { Group: "Mouth", Name: "Grin", Timer: 10}, { Group: "Eyebrows", Name: "Soft", Timer: 10}]
	}, {
		Name: "ShockWand",
		Property: { Type: "ShockWand" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Medium", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Wink", Timer: 5 }]
	}, {
		Name: "Lotion",
		Property: { Type: "Lotion" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	}, {
		Name: "Ruler",
		Property: { Type: "Ruler" },
		ExpressionTrigger: [{ Group: "Blush", Name: "High", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Eyes", Name: "Closed", Timer: 5 }]
	}, {
		Name: "Sword",
		Property: { Type: "Sword" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 5 }, { Group: "Eyebrows", Name: "Harsh", Timer: 5 }]
	}, {
		Name: "VibeRemote",
		Property: { Type: "VibeRemote" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	}, {
		Name: "ShockRemote",
		Property: { Type: "ShockRemote" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "Towel",
		Property: { Type: "Towel" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "RopeCoilLong",
		Property: { Type: "RopeCoilLong" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "RopeCoilShort",
		Property: { Type: "RopeCoilShort" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "Ballgag",
		Property: { Type: "Ballgag" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "LongSock",
		Property: { Type: "LongSock" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "Baguette",
		Property: { Type: "Baguette" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "Panties",
		Property: { Type: "Panties" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	},{
		Name: "TapeRoll",
		Property: { Type: "TapeRoll" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 10 }, { Group: "Eyebrows", Name: "Soft", Timer: 10 }, { Group: "Mouth", Name: "Frown", Timer: 10 }]
	}, {
		Name: "Spatula",
		Property: { Type: "Spatula" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 5 }, { Group: "Eyebrows", Name: "Harsh", Timer: 5 }]
	}, {
		Name: "Broom",
		Property: { Type: "Broom" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 5 }, { Group: "Eyebrows", Name: "Harsh", Timer: 5 }]
	},{
		Name: "Phone1",
		Property: { Type: "Phone1" },
		ExpressionTrigger: []
	},{
		Name: "Phone2",
		Property: { Type: "Phone2" },
		ExpressionTrigger: []
	},{
		Name: "Scissors",
		Property: { Type: "Scissors" },
		ExpressionTrigger: []
	},{

		Name: "PlasticWrap",
		Property: { Type: "PlasticWrap" },
		ExpressionTrigger: []
	},{
		Name: "GlassEmpty",
		Property: { Type: "GlassEmpty" },
		ExpressionTrigger: []
	},{
		Name: "GlassFilled",
		Property: { Type: "GlassFilled" },
		ExpressionTrigger: [{ Group: "Blush", Name: "Low", Timer: 5}, { Group: "Mouth", Name: "LipBite", Timer: 5}, { Group: "Eyes", Name: "Lewd", Timer: 5}, { Group: "Eyebrows", Name: "Raised", Timer: 5}]
	},{
		Name: "PotionBottle",
		Property: { Type: "PotionBottle" },
		ExpressionTrigger: []
	},
];

/** Loads the item extension properties */
function InventoryItemHandsSpankingToysLoad() {
	ExtendedItemLoad(InventorySpankingToysAvailableToys(CharacterGetCurrent()), "SelectSpankingToysType");
}

/** Draw the item extension screen */
function InventoryItemHandsSpankingToysDraw() {
	ExtendedItemDraw(InventorySpankingToysAvailableToys(CharacterGetCurrent()), "SpankingToysType");
}

/** Catches the item extension clicks */
function InventoryItemHandsSpankingToysClick() {
	ExtendedItemClick(InventorySpankingToysAvailableToys(CharacterGetCurrent()));
}

/**
 * Publishes the message to the chat
 * @param {Character} C - The target character
 * @param {ExtendedItemOption} Option - The currently selected Option
 * @returns {void} - Nothing
 */
function InventoryItemHandsSpankingToysPublishAction(C, Option) {
	var msg = C.ID == 0 ? "SpankingToysSetPlayer" : "SpankingToysSetOthers";
	var Dictionary = [];
	Dictionary.push({ Tag: "SourceCharacter", Text: CharacterNickname(Player), MemberNumber: Player.MemberNumber });
	Dictionary.push({ Tag: "TargetCharacter", Text: CharacterNickname(C), MemberNumber: C.MemberNumber });
	Dictionary.push({ Tag: "ItemUsed", AssetName: "SpankingToys" + Option.Name });
	ChatRoomPublishCustomAction(msg, true, Dictionary);
}

/**
 * The NPC dialog is for what the NPC says to you when you make a change to their restraints - the dialog lookup is on a
 * per-NPC basis. You basically put the "AssetName" + OptionName in there to allow individual NPCs to override their default
 * "GroupName" dialog if for example we ever wanted an NPC to react specifically to having the restraint put on them.
 * That could be done by adding an "AssetName" entry (or entries) to that NPC's dialog CSV
 * @param {Character} C - The NPC to whom the restraint is applied
 * @param {ExtendedItemOption} Option - The chosen option for this extended item
 * @returns {void} - Nothing
 */
function InventoryItemHandsSpankingToysNpcDialog(C, Option) {
	C.CurrentDialog = DialogFind(C, "SpankingToys" + Option.Name, "ItemHands");
}

/**
 * Returns a list of the spanking toys that can be equipped to the character
 * @param {Character} C - The character the toy will be given to
 * @returns {ExtendedItemOption[]} The subset of SpankingToys options the player can select from
 */
function InventorySpankingToysAvailableToys(C) {
	// Toys the player or target character owns
	let PlayerToys = Player.Inventory.map(i => i.Name).filter(x => x.match(/SpankingToys\w/));
	let TargetToys = C.Inventory.map(i => i.Name).filter(x => x.match(/SpankingToys\w/));
	let AvailableToys = PlayerToys.concat(TargetToys.filter(T => !PlayerToys.includes(T)));
	return InventoryItemHandsSpankingToysOptions.filter(x => AvailableToys.includes("SpankingToys" + x.Name));
}

/**
 * Get the type of spanking toy that the character is holding
 * @param {Character} C
 * @returns {string}
 */
function InventorySpankingToysGetType(C) {
	var Toy = InventoryGet(C, "ItemHands");
	if (Toy && Toy.Asset.Name === "SpankingToys" && Toy.Property && Toy.Property.Type) return Toy.Property.Type;
	else return "Crop";
}

/**
 * Get the description of the spanking toy that the character is holding
 * @param {Character} C
 * @returns {string}
 */
function InventorySpankingToysGetDescription(C) {
	var ToyDescription = null;
	var Toy = InventoryGet(C, "ItemHands");
	if (Toy != null) {
		ToyDescription = "Crop";
		if (Toy.Property && Toy.Property.Type) {
			var A = AssetGet(C.AssetFamily, "ItemHands", "SpankingToys" + Toy.Property.Type);
			if (A != null) ToyDescription = A.Description;
		}
	}
	return ToyDescription || "Handheld Item";
}

/**
 * Get the activity of the spanking toy that the character is holding
 * @param {Character} C
 * @returns {string | null}
 */
function InventorySpankingToysGetActivity(C) {
	var Type = InventorySpankingToysGetType(C);
	var A = AssetGet(C.AssetFamily, "ItemHands", "SpankingToys" + Type);
	return A && A.Activity || A && A.AllowActivity[0] || null;
}

/**
 * Determine whether an item activity is allowed on the selected region
 * @param {Character} C
 * @returns {boolean}
 */
function InventorySpankingToysActivityAllowed(C) {
	const Type = InventorySpankingToysGetType(Player);
	const A = AssetGet(C.AssetFamily, "ItemHands", "SpankingToys" + Type);
	if (InventoryBlockedOrLimited(C, { Asset: A }))
		return false;
	if (C.FocusGroup != null && A.AllowActivity) {
		return A.AllowActivity.some(itemAct => {
			return ActivityAllowedForGroup(C, C.FocusGroup.Name, true)
				// @ts-ignore
				.some(act => itemAct === act.Name);
			});
	}
	return false;
}

/**
 * Returns the audio sound to be played
 * @param {Character} C
 * @returns {string}
 */
function InventorySpankingToysGetAudio(C) {
	const Type = InventorySpankingToysGetType(C);
	const A = AssetGet(C.AssetFamily, "ItemHands", "SpankingToys" + Type);
	return A && A.Audio;
}
